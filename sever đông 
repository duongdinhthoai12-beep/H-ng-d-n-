
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

local placeId = game.PlaceId
local currentJob = game.JobId
local player = Players.LocalPlayer

local servers = {}
local cursor = ""

repeat
    local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Desc&limit=100"
    if cursor ~= "" then
        url = url .. "&cursor=" .. cursor
    end

    local response = game:HttpGet(url)
    local data = HttpService:JSONDecode(response)

    for _,server in pairs(data.data) do
        local freeSlots = server.maxPlayers - server.playing
        
        -- chỉ lấy server còn ít nhất 2 slot trống
        if freeSlots >= 2 and server.id ~= currentJob then
            table.insert(servers, server)
        end
    end

    cursor = data.nextPageCursor
until cursor == nil

-- sắp xếp đông nhất trước
table.sort(servers, function(a,b)
    return a.playing > b.playing
end)

-- thử teleport từng server cho tới khi thành công
for _,server in ipairs(servers) do
    local success, err = pcall(function()
        TeleportService:TeleportToPlaceInstance(placeId, server.id, player)
    end)

    if success then
        break
    end
    task.wait(1)
end